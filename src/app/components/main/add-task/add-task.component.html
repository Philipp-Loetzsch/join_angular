<h1>Add Task</h1>
<form [formGroup]="addTaskForm" (ngSubmit)="onSubmit()">
  <div>
    <div>
      <label for="title">Title<span class="required">*</span></label>
      <input
      type="text"
      id="title"
      placeholder="Enter a title"
      class="input-field"
      [ngClass]="{ 'input-field--required': isFieldInvalid('title') }"
      formControlName="title"
    />
    
      <label
        for="title"
        [ngClass]="{ 'required-text': isFieldInvalid('title') }"    
        [class.empty-field]="!(addTaskForm.get('title')?.touched && addTaskForm.get('title')?.invalid)"
      >
        {{addTaskForm.get("title")?.touched && addTaskForm.get("title")?.invalid ? "This field is required": ""}}
      </label>

      <label for="description">Description</label>
      <textarea
        id="description"
        class="input-field description"
        placeholder="Enter a Description"
        rows="3"
        cols="25"
        formControlName="description"
      ></textarea>

      <label for="assigned">Assigned to<span class="required">*</span></label>
      <div 
        class="input-field contact-field"
        [ngClass]="{ 'input-field--required': isFieldInvalid('assigned') }">
        <input
          (focus)="showContactList = true"
          type="search"
          id="assigned"
          placeholder="Select contacts to assign"
          class="font-black"
          #assingedInput
          (keyup)="filterContacts(assingedInput.value)"
        />
        <img (click)="toggleContactList()" [src]="'img/add_task/arrow_drop_down.svg'" [ngClass]="{ 'rotated': showContactList }" alt=""/>
        <div *ngIf="showContactList" class="contact-list">
          <ul *ngFor="let contact of filteredContacts let i = index" >
            <li 
              class="single-contact" 
              [ngClass]="{'single-contact--chosen' : chosen[i] }" 
              (click)="chooseContact(contact.name, contact.color, contact.id, i)" >
              <div>
                <span class="shortcut--small" [style.backgroundColor]="contact.color">{{ getShortcut(contact.name) }}</span> 
                <span>{{contact.name}}</span>
              </div>
              <img [src]="(chosen[i]) ? 'img/add_task/check_button_checked.svg' : 'img/add_task/check_button.svg'" alt="">
            </li>
          </ul>
        </div>
        <div class="chosen-contacts">
          <ul *ngFor="let chosenContact of assigned.value">
            <li class="single-contact"> 
              <span class="shortcut--small" [style.backgroundColor]="chosenContact.color">{{ getShortcut(chosenContact.name) }}</span> 
              <span>{{chosenContact.name}}</span></li>
          </ul>
        </div>
      </div>
    
      <label
        for="assigned"
        [ngClass]="{ 'required-text': isFieldInvalid('assigned') }"   
        [class.empty-field]="!( addTaskForm.get('assigned')?.touched &&  addTaskForm.get('assigned')?.invalid)"
      >
        {{ addTaskForm.get("assigned")?.touched && addTaskForm.get("assigned")?.invalid ? "This field is required" : ""}}
      </label>
    </div>

    <div class="separator"></div>

    <div>
      <label for="dueDate">Due date<span class="required">*</span></label>

        <mat-form-field appearance="fill" class="input-field--nopadding"
        [ngClass]="{ 'input-field--required': isFieldInvalid('dueDate') }"> 
           <mat-label>DD/MM/YYYY</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            id="dueDate"
            formControlName="dueDate"
          />
          <mat-datepicker-toggle matSuffix [for]="picker"> </mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
         </mat-form-field>     
      <label
        for="dueDate"
        [ngClass]="{ 'required-text': isFieldInvalid('dueDate') }"   
        [class.empty-field]="!(addTaskForm.get('dueDate')?.touched && addTaskForm.get('dueDate')?.invalid)"
      >
        {{addTaskForm.get("dueDate")?.touched &&addTaskForm.get("dueDate")?.invalid ? "This field is required" : ""}}
      </label>

      <div class="prio">
        <span>Prio</span>
        <div class="btn-prio">
          <button
            type="button"
            (click)="addTaskForm.get('priority')?.setValue('Urgent'); chosenPrio = 'urgent'" [ngClass]="{ urgent: chosenPrio === 'urgent' }">
            Urgent
            <img
              [src]="chosenPrio === 'urgent' ? 'img/add_task/urgent_white.svg' : 'img/add_task/urgent.svg'" alt=""/>
          </button>
          <button
            type="button"
            (click)="addTaskForm.get('priority')?.setValue('Medium'); chosenPrio = 'medium'"[ngClass]="{ medium: chosenPrio === 'medium' }">
            Medium
            <img
              [src]="chosenPrio === 'medium' ? 'img/add_task/medium_white.svg' : 'img/add_task/medium.svg'" alt=""/>
          </button>
          <button
            type="button"
            (click)=" addTaskForm.get('priority')?.setValue('Low'); chosenPrio = 'low'"[ngClass]="{ low: chosenPrio === 'low' }"
          >
            Low
            <img
              [src]="chosenPrio === 'low' ? 'img/add_task/low_white.svg' : 'img/add_task/low.svg'"
              alt=""
            />
          </button>
        </div>
      </div>
      <label for="category">Category<span class="required">*</span></label>
      <div class="category-field">
        <button 
          type="button"
          class="input-field btn-category"
          [ngClass]="{ 'input-field--required': isFieldInvalid('category') && !haveCategory }"
          (click)="toggleCategorySelector()"
          >
          <span >{{ textCategory}}</span>
          <img src="img/add_task/arrow_drop_down.svg" alt="" />
        </button>
        <label
          for="category"
          class="empty-field"
          [ngClass]="{ 'required-text': isFieldInvalid('category')}">
          {{ isFieldInvalid('category') && !haveCategory ? "This field is required" : "" }}
      </label>
      <div class="category-selector" *ngIf="showCategorySelector">
        <button type="button" (click)="chooseCategory('Technical Task')">Technical Task</button>
        <button type="button" (click)="chooseCategory('User Story')">User Story</button>
      </div>
      </div>
   

      <label for="subtasks">Subtasks</label>
      <div class="subtask">
        <div  class="input-field">
          <input
            type="text"
            id="subtasks"
            placeholder="Add new subtask"
            #subtasksInput
          />
          <img class="add-subtask" (click)="addSubtask(subtasksInput)" src="img/plus.svg" alt="">
        </div>
       
        <div  class="subtask-list">
          <ul *ngFor="let subtask of subtasks.value let i=index">
            <li>
             <div class="subtask-list_item">
              <span>{{subtask.subtaskValue}}</span>
              <div>
                <button type="button" (click)="editSubtask(i)"><img src="img/edit.svg" alt=""></button>
                <button type="button" (click)="deleteSubtask(i)"><img src="img/delete.svg" alt=""></button>
              </div>
             </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="submit-field">
    <span>
      <span class="required">*</span>
      This field is required
    </span>
    <div>
      <button class="btn-secondary--default" type="button" (click)="clearForm()">Clear X</button>
      <button class="btn-primary--default" type="submit">Create Task </button>
    </div>
  </div>
</form>
